export class LogManager {
  _depth = 0;
  _socketMap;
  constructor(args){
    this._socketMap = args.socketMap;
  }
  addLogEntry(entry) {
    if (entry.root) {
      this.rootLog(entry);
    } else {
      this.sendLogs(entry);
    }
  }
  rootLog(entry) {
    this.startChain();
    this.sendLogs(entry);
    this.enter();
  }
  _queue = [];
  sendLogs(entry) {
    this._queue.push({
      ...entry,
      depth: this._depth
    });
  }
  flushQueue() {
    if (!this._queue.length) return;
    this._socketMap.forEach((s)=>s.emit('addLogEntry', [
        ...this._queue
      ]));
    this._queue = [];
  }
  startChain() {
    this._depth = 0;
  }
  enter() {
    this._depth++;
  }
  exit() {
    this._depth = Math.max(0, this._depth - 1);
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vYXBwL3NlcnZlci9zcmMvY29yZS9sb2ctbWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMb2dFbnRyeSwgUGxheWVySWQgfSBmcm9tICdzaGFyZWQvc2hhcmVkLXR5cGVzLnRzJztcbmltcG9ydCB7IEFwcFNvY2tldCwgRGlzdHJpYnV0aXZlT21pdCB9IGZyb20gJy4uL3R5cGVzLnRzJztcblxuZXhwb3J0IGNsYXNzIExvZ01hbmFnZXIge1xuICBwcml2YXRlIF9kZXB0aDogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSByZWFkb25seSBfc29ja2V0TWFwOiBNYXA8UGxheWVySWQsIEFwcFNvY2tldD47XG4gIFxuICBjb25zdHJ1Y3RvcihhcmdzOiB7IHNvY2tldE1hcDogTWFwPFBsYXllcklkLCBBcHBTb2NrZXQ+IH0pIHtcbiAgICB0aGlzLl9zb2NrZXRNYXAgPSBhcmdzLnNvY2tldE1hcDtcbiAgfVxuICBcbiAgcHVibGljIGFkZExvZ0VudHJ5KGVudHJ5OiBEaXN0cmlidXRpdmVPbWl0PExvZ0VudHJ5LCAnZGVwdGgnPiAmIHsgcm9vdD86IGJvb2xlYW47IH0pIHtcbiAgICBpZiAoZW50cnkucm9vdCkge1xuICAgICAgdGhpcy5yb290TG9nKGVudHJ5KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLnNlbmRMb2dzKGVudHJ5KTtcbiAgICB9XG4gIH1cbiAgXG4gIHByaXZhdGUgcm9vdExvZyhlbnRyeTogTG9nRW50cnkpIHtcbiAgICB0aGlzLnN0YXJ0Q2hhaW4oKTtcbiAgICB0aGlzLnNlbmRMb2dzKGVudHJ5KTtcbiAgICB0aGlzLmVudGVyKCk7XG4gIH1cbiAgXG4gIHByaXZhdGUgX3F1ZXVlOiBMb2dFbnRyeVtdID0gW107XG4gIFxuICBwcml2YXRlIHNlbmRMb2dzKGVudHJ5OiBMb2dFbnRyeSkge1xuICAgIHRoaXMuX3F1ZXVlLnB1c2goeyAuLi5lbnRyeSwgZGVwdGg6IHRoaXMuX2RlcHRoIH0pO1xuICB9XG4gIFxuICBwdWJsaWMgZmx1c2hRdWV1ZSgpIHtcbiAgICBpZiAoIXRoaXMuX3F1ZXVlLmxlbmd0aCkgcmV0dXJuO1xuICAgIHRoaXMuX3NvY2tldE1hcC5mb3JFYWNoKChzKSA9PiBzLmVtaXQoJ2FkZExvZ0VudHJ5JywgWy4uLnRoaXMuX3F1ZXVlXSkpO1xuICAgIHRoaXMuX3F1ZXVlID0gW107XG4gIH1cbiAgXG4gIHB1YmxpYyBzdGFydENoYWluKCkge1xuICAgIHRoaXMuX2RlcHRoID0gMDtcbiAgfVxuICBcbiAgcHVibGljIGVudGVyKCkge1xuICAgIHRoaXMuX2RlcHRoKys7XG4gIH1cbiAgXG4gIHB1YmxpYyBleGl0KCkge1xuICAgIHRoaXMuX2RlcHRoID0gTWF0aC5tYXgoMCwgdGhpcy5fZGVwdGggLSAxKTtcbiAgfVxufSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFHQSxPQUFPLE1BQU07RUFDSCxTQUFpQixFQUFFO0VBQ1YsV0FBcUM7RUFFdEQsWUFBWSxJQUE2QyxDQUFFO0lBQ3pELElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxTQUFTO0VBQ2xDO0VBRU8sWUFBWSxLQUFnRSxFQUFFO0lBQ25GLElBQUksTUFBTSxJQUFJLEVBQUU7TUFDZCxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQ2YsT0FDSztNQUNILElBQUksQ0FBQyxRQUFRLENBQUM7SUFDaEI7RUFDRjtFQUVRLFFBQVEsS0FBZSxFQUFFO0lBQy9CLElBQUksQ0FBQyxVQUFVO0lBQ2YsSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUNkLElBQUksQ0FBQyxLQUFLO0VBQ1o7RUFFUSxTQUFxQixFQUFFLENBQUM7RUFFeEIsU0FBUyxLQUFlLEVBQUU7SUFDaEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7TUFBRSxHQUFHLEtBQUs7TUFBRSxPQUFPLElBQUksQ0FBQyxNQUFNO0lBQUM7RUFDbEQ7RUFFTyxhQUFhO0lBQ2xCLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRTtJQUN6QixJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQU0sRUFBRSxJQUFJLENBQUMsZUFBZTtXQUFJLElBQUksQ0FBQyxNQUFNO09BQUM7SUFDckUsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFO0VBQ2xCO0VBRU8sYUFBYTtJQUNsQixJQUFJLENBQUMsTUFBTSxHQUFHO0VBQ2hCO0VBRU8sUUFBUTtJQUNiLElBQUksQ0FBQyxNQUFNO0VBQ2I7RUFFTyxPQUFPO0lBQ1osSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUc7RUFDMUM7QUFDRiJ9
// denoCacheMetadata=16834677168460804217,9771141214555024838